services:
  - type: web
    name: marketscannerpros
    runtime: node
    buildCommand: npm install && npm run build
    startCommand: npm start
    envVars:
      - key: NODE_ENV
        value: production
  # Cron Jobs for Alerts
  - type: cron
    name: alerts-price-check
    runtime: node
    schedule: "*/5 * * * *"  # Every 5 minutes
    buildCommand: echo "Cron job ready"
    startCommand: curl -X POST "$RENDER_EXTERNAL_URL/api/alerts/check" -H "x-cron-secret:$CRON_SECRET" -H "Content-Type:application/json"
    envVars:
      - key: RENDER_EXTERNAL_URL
        fromService:
          name: marketscannerpros
          type: web
          property: url
      - key: CRON_SECRET
        sync: false

  - type: cron
    name: alerts-signal-check
    runtime: node
    schedule: "*/10 * * * *"  # Every 10 minutes
    buildCommand: echo "Cron job ready"
    startCommand: curl -X POST "$RENDER_EXTERNAL_URL/api/alerts/signal-check" -H "x-cron-secret:$CRON_SECRET" -H "Content-Type:application/json"
    envVars:
      - key: RENDER_EXTERNAL_URL
        fromService:
          name: marketscannerpros
          type: web
          property: url
      - key: CRON_SECRET
        sync: false

  - type: cron
    name: alerts-strategy-check
    runtime: node
    schedule: "*/15 * * * *"  # Every 15 minutes
    buildCommand: echo "Cron job ready"
    startCommand: curl -X POST "$RENDER_EXTERNAL_URL/api/alerts/strategy-check" -H "x-cron-secret:$CRON_SECRET" -H "Content-Type:application/json"
    envVars:
      - key: RENDER_EXTERNAL_URL
        fromService:
          name: marketscannerpros
          type: web
          property: url
      - key: CRON_SECRET
        sync: false

  - type: cron
    name: daily-market-focus
    runtime: node
    schedule: "0 21 * * *"  # 9 PM UTC daily
    buildCommand: echo "Cron job ready"
    startCommand: curl -X POST "$RENDER_EXTERNAL_URL/api/jobs/generate-market-focus" -H "x-cron-secret:$CRON_SECRET" -H "Content-Type:application/json"
    envVars:
      - key: RENDER_EXTERNAL_URL
        fromService:
          name: marketscannerpros
          type: web
          property: url
      - key: CRON_SECRET
        sync: false

  - type: cron
    name: daily-scan
    runtime: node
    schedule: "30 21 * * *"  # 9:30 PM UTC daily
    buildCommand: echo "Cron job ready"
    startCommand: curl -X POST "$RENDER_EXTERNAL_URL/api/jobs/scan-daily" -H "x-cron-secret:$CRON_SECRET" -H "Content-Type:application/json"
    envVars:
      - key: RENDER_EXTERNAL_URL
        fromService:
          name: marketscannerpros
          type: web
          property: url
      - key: CRON_SECRET
        sync: false