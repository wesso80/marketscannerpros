"use strict";(()=>{var e={};e.id=757,e.ids=[757],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1282:e=>{e.exports=require("child_process")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},1764:e=>{e.exports=require("util")},7218:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>x,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>b,staticGenerationAsyncStorage:()=>h});var o={};r.r(o),r.d(o,{POST:()=>c});var i=r(9303),s=r(8716),n=r(670),a=r(7070);let p=new(r(1059)).Z(process.env.STRIPE_SECRET_KEY,{apiVersion:"2025-08-27.basil"}),u=process.env.STRIPE_WEBHOOK_SECRET;async function c(e){try{let t;let r=await e.text(),o=e.headers.get("stripe-signature");try{t=p.webhooks.constructEvent(r,o,u)}catch(e){return console.log("Webhook signature verification failed:",e.message),a.NextResponse.json({error:"Invalid signature"},{status:400})}if("checkout.session.completed"===t.type){let r=t.data.object;if("subscription"===r.mode&&r.subscription){let t=await p.subscriptions.retrieve(r.subscription),o=t.items.data[0]?.price?.unit_amount||0,i="pro";o>=999&&(i="pro_trader"),console.log(`Subscription created: ${t.id}, Plan: ${i}, Customer: ${r.customer_email}`);let s=`${e.nextUrl.origin}/api/subscription/update`;await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({stripeSubscriptionId:t.id,customerEmail:r.customer_email,planType:i,status:"active"})})}}if("customer.subscription.deleted"===t.type){let r=t.data.object;console.log(`Subscription cancelled: ${r.id}`);let o=`${e.nextUrl.origin}/api/subscription/update`;await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({stripeSubscriptionId:r.id,status:"cancelled"})})}return a.NextResponse.json({received:!0})}catch(e){return console.error("Webhook error:",e),a.NextResponse.json({error:"Webhook handler failed"},{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/stripe/webhook/route",pathname:"/api/stripe/webhook",filename:"route",bundlePath:"app/api/stripe/webhook/route"},resolvedPagePath:"/home/runner/workspace/app/api/stripe/webhook/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:l,staticGenerationAsyncStorage:h,serverHooks:b}=d,m="/api/stripe/webhook/route";function x(){return(0,n.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:h})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[948,972,59],()=>r(7218));module.exports=o})();